<div class="container">
    <% if (errors) { %>
    <% errors.forEach(function (error) { %>
    <%= __(error) %>
    <% }) %>
    <% } %>

    <div class="block">

        <form id="create" role="form" action="/pin/create" method="post">
            <legend>Create new Pin</legend>

            <div class="form-group">
                <label for="title">Title</label>
                <input id="title" type="text" name="title" placeholder="title ..." autofocus="true"
                       class="form-control">
            </div>

            <div class="form-group">
                <label for="description">Description</label>
                <input id="description" type="text" name="description" placeholder="description ..." autofocus="true"
                       class="form-control">
            </div>

            <!-- Todo: Add category -->
            <div class="form-group">
                <label for="category">Category</label>
                <input id="category" type="text" name="category" placeholder="category ..." autofocus="true"
                       class="form-control">
            </div>

            <!--- Location -->
            <!-- Todo: location: Pick a location: using polygons / circles / slider for radius -->
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Location</h3>
                </div>
                <div class="panel-body" id="map-container">
                    <div id="react" data-uid="<%= req.user.id %>"></div>
                </div>
            </div>

            <!-- Upload Images -->
            <div class="form-group">
                <label for="category">Images</label>

                <div id="dropzone" class="dropzone dz-clickable"></div>
            </div>

            <button type="submit" class="btn btn-primary">Create</button>

        </form>

    </div>

</div>

<link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css"/>
<link rel="stylesheet" href="/bower_components/dropzone/dist/dropzone.css"/>
<style>

    .dropzone.dz-clickable {
        cursor: pointer;
    }

    .dropzone {
        border: 2px dashed #0087F7;
        border-radius: 5px;
        background: white;
    }

    .item {
        color: #333;
        float: left;
        font-size: 12px;
        /*
        width: 165px;
        */
        padding-left: 5px;
        margin: 0;
    }

    .itemContent {
        padding-left: 0;
        color: #9197a3;
        /*
        font-weight: bold;
        width: 445px;
        */
        margin-left: 175px;

        font-size: 12px;
    }

    .row {
        border-width: 0;
        border-color: #e9eaed;
        border-style: solid;
    }

    .list {
        border-bottom: 1px solid #aaa;
        border-top: 1px solid #aaa;
        list-style-type: none;
        word-wrap: break-word;
        padding: 0 20px;
        /*
        width: 759px;
        */
        margin-right: 0;
    }

    html, body {
        height: 100%;
        background: #e9eaed;
    }

    #react {
        width: 500px;
        height: 400px;
    }

    .map {
        width: 100%;
        height: 100%;
    }

</style>
<link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css"/>
<script src="/bower_components/requirejs/require.js"></script>
<script src="/bower_components/jquery/dist/jquery.js"></script>
<script src="/bower_components/dropzone/dist/dropzone.js"></script>
<script>
    if (document.getElementById('dropzone')) {
        var Dropzone = new Dropzone("div#dropzone", {url: "/file/post"});
    }

    $("#create").submit(function (event) {
        console.info("Handler for .submit() called.");
        event.preventDefault();

        var data = {
            title: $("#title").val(),
            description: $("#description").val(),
            category: $("#category").val(),
            location: window.selectedLocation
        };

        $.ajax({
            'type': "POST",
            'async': false,
            'global': false,
            'data': data,
            'url': "/pin/create",
            'dataType': "json",
            'success': function (data) {
                console.info("User seems to be updated correctly: " + JSON.stringify(data))
                //callback(null, data);
            },
            'error': function (error) {
                console.info("Error occured: " + JSON.stringify(error))
                //callback(error, null)
            }
        });
    });
</script>
<script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true&libraries=drawing"></script>
<% if(req.user.neighborhoods.length > 0){ %>
<script id="argScript"
        src="/linker/js/neighborhood/main.js?uid=<%= req.user.id %>&n=<%= JSON.stringify(req.user.neighborhoods[0].coordinates) %>&type=<%= JSON.stringify(req.user.neighborhoods[0].type.replace('"', '')) %>&page=create"></script>
<% }else{ %>
<script id="argScript"
        src="/linker/js/neighborhood/main.js?uid=<%= req.user.id %>&n=<%= JSON.stringify(req.user.neighborhoods) %>&page=create"></script>
<%
} %>